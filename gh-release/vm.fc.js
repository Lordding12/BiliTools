"use strict";var t=require("zlib"),e=require("path"),n=require("fs"),r=require("axios");require("vm");var o=require("nodemailer"),i=require("tunnel"),a=require("crypto"),s=require("json5");function c(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function u(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var f=u(e),l=c(r),d=u(o),p=u(i),g=u(a),m=u(s);const h=["棒","棒唉","棒耶","加油~","UP加油!","支持~","支持支持！","催更啦","顶顶","留下脚印~","干杯","bilibili干杯","o(*￣▽￣*)o","(｡･∀･)ﾉﾞ嗨","(●ˇ∀ˇ●)","( •̀ ω •́ )y","(ง •_•)ง",">.<","^_~"],y=["舰","船","航海","代金券","优惠券","自拍","照","写真","图","提督","车车一局","再来一局","游戏道具"],v=["谢"],_=[65566781,1277481241,1643654862,603676925];var w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},T=function(t){return t&&t.Math==Math&&t},b=T("object"==typeof globalThis&&globalThis)||T("object"==typeof window&&window)||T("object"==typeof self&&self)||T("object"==typeof w&&w)||function(){return this}()||Function("return this")(),$={},O=function(t){try{return!!t()}catch(t){return!0}},E=!O((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),S=!O((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),I=S,C=Function.prototype.call,P=I?C.bind(C):function(){return C.apply(C,arguments)},x={},A={}.propertyIsEnumerable,R=Object.getOwnPropertyDescriptor,N=R&&!A.call({1:2},1);x.f=N?function(t){var e=R(this,t);return!!e&&e.enumerable}:A;var L,k,U=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},j=S,D=Function.prototype,B=D.bind,G=D.call,q=j&&B.bind(G,G),M=j?function(t){return t&&q(t)}:function(t){return t&&function(){return G.apply(t,arguments)}},H=M,K=H({}.toString),Y=H("".slice),F=function(t){return Y(K(t),8,-1)},J=M,Q=O,z=F,W=b.Object,X=J("".split),V=Q((function(){return!W("z").propertyIsEnumerable(0)}))?function(t){return"String"==z(t)?X(t,""):W(t)}:W,Z=b.TypeError,tt=function(t){if(null==t)throw Z("Can't call method on "+t);return t},et=V,nt=tt,rt=function(t){return et(nt(t))},ot=function(t){return"function"==typeof t},it=ot,at=function(t){return"object"==typeof t?null!==t:it(t)},st=b,ct=ot,ut=function(t){return ct(t)?t:void 0},ft=function(t,e){return arguments.length<2?ut(st[t]):st[t]&&st[t][e]},lt=M({}.isPrototypeOf),dt=b,pt=ft("navigator","userAgent")||"",gt=dt.process,mt=dt.Deno,ht=gt&&gt.versions||mt&&mt.version,yt=ht&&ht.v8;yt&&(k=(L=yt.split("."))[0]>0&&L[0]<4?1:+(L[0]+L[1])),!k&&pt&&(!(L=pt.match(/Edge\/(\d+)/))||L[1]>=74)&&(L=pt.match(/Chrome\/(\d+)/))&&(k=+L[1]);var vt=k,_t=O,wt=!!Object.getOwnPropertySymbols&&!_t((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&vt&&vt<41})),Tt=wt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,bt=ft,$t=ot,Ot=lt,Et=Tt,St=b.Object,It=Et?function(t){return"symbol"==typeof t}:function(t){var e=bt("Symbol");return $t(e)&&Ot(e.prototype,St(t))},Ct=b.String,Pt=function(t){try{return Ct(t)}catch(t){return"Object"}},xt=ot,At=Pt,Rt=b.TypeError,Nt=function(t){if(xt(t))return t;throw Rt(At(t)+" is not a function")},Lt=Nt,kt=function(t,e){var n=t[e];return null==n?void 0:Lt(n)},Ut=P,jt=ot,Dt=at,Bt=b.TypeError,Gt={exports:{}},qt=b,Mt=Object.defineProperty,Ht=function(t,e){try{Mt(qt,t,{value:e,configurable:!0,writable:!0})}catch(n){qt[t]=e}return e},Kt=Ht,Yt=b["__core-js_shared__"]||Kt("__core-js_shared__",{}),Ft=Yt;(Gt.exports=function(t,e){return Ft[t]||(Ft[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.22.7",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.22.7/LICENSE",source:"https://github.com/zloirock/core-js"});var Jt=tt,Qt=b.Object,zt=function(t){return Qt(Jt(t))},Wt=zt,Xt=M({}.hasOwnProperty),Vt=Object.hasOwn||function(t,e){return Xt(Wt(t),e)},Zt=M,te=0,ee=Math.random(),ne=Zt(1..toString),re=function(t){return"Symbol("+(void 0===t?"":t)+")_"+ne(++te+ee,36)},oe=b,ie=Gt.exports,ae=Vt,se=re,ce=wt,ue=Tt,fe=ie("wks"),le=oe.Symbol,de=le&&le.for,pe=ue?le:le&&le.withoutSetter||se,ge=function(t){if(!ae(fe,t)||!ce&&"string"!=typeof fe[t]){var e="Symbol."+t;ce&&ae(le,t)?fe[t]=le[t]:fe[t]=ue&&de?de(e):pe(e)}return fe[t]},me=P,he=at,ye=It,ve=kt,_e=function(t,e){var n,r;if("string"===e&&jt(n=t.toString)&&!Dt(r=Ut(n,t)))return r;if(jt(n=t.valueOf)&&!Dt(r=Ut(n,t)))return r;if("string"!==e&&jt(n=t.toString)&&!Dt(r=Ut(n,t)))return r;throw Bt("Can't convert object to primitive value")},we=ge,Te=b.TypeError,be=we("toPrimitive"),$e=function(t,e){if(!he(t)||ye(t))return t;var n,r=ve(t,be);if(r){if(void 0===e&&(e="default"),n=me(r,t,e),!he(n)||ye(n))return n;throw Te("Can't convert object to primitive value")}return void 0===e&&(e="number"),_e(t,e)},Oe=It,Ee=function(t){var e=$e(t,"string");return Oe(e)?e:e+""},Se=at,Ie=b.document,Ce=Se(Ie)&&Se(Ie.createElement),Pe=function(t){return Ce?Ie.createElement(t):{}},xe=Pe,Ae=!E&&!O((function(){return 7!=Object.defineProperty(xe("div"),"a",{get:function(){return 7}}).a})),Re=E,Ne=P,Le=x,ke=U,Ue=rt,je=Ee,De=Vt,Be=Ae,Ge=Object.getOwnPropertyDescriptor;$.f=Re?Ge:function(t,e){if(t=Ue(t),e=je(e),Be)try{return Ge(t,e)}catch(t){}if(De(t,e))return ke(!Ne(Le.f,t,e),t[e])};var qe={},Me=E&&O((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),He=b,Ke=at,Ye=He.String,Fe=He.TypeError,Je=function(t){if(Ke(t))return t;throw Fe(Ye(t)+" is not an object")},Qe=E,ze=Ae,We=Me,Xe=Je,Ve=Ee,Ze=b.TypeError,tn=Object.defineProperty,en=Object.getOwnPropertyDescriptor;qe.f=Qe?We?function(t,e,n){if(Xe(t),e=Ve(e),Xe(n),"function"==typeof t&&"prototype"===e&&"value"in n&&"writable"in n&&!n.writable){var r=en(t,e);r&&r.writable&&(t[e]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return tn(t,e,n)}:tn:function(t,e,n){if(Xe(t),e=Ve(e),Xe(n),ze)try{return tn(t,e,n)}catch(t){}if("get"in n||"set"in n)throw Ze("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var nn=qe,rn=U,on=E?function(t,e,n){return nn.f(t,e,rn(1,n))}:function(t,e,n){return t[e]=n,t},an={exports:{}},sn=E,cn=Vt,un=Function.prototype,fn=sn&&Object.getOwnPropertyDescriptor,ln=cn(un,"name"),dn={EXISTS:ln,PROPER:ln&&"something"===function(){}.name,CONFIGURABLE:ln&&(!sn||sn&&fn(un,"name").configurable)},pn=ot,gn=Yt,mn=M(Function.toString);pn(gn.inspectSource)||(gn.inspectSource=function(t){return mn(t)});var hn,yn,vn,_n=gn.inspectSource,wn=ot,Tn=_n,bn=b.WeakMap,$n=wn(bn)&&/native code/.test(Tn(bn)),On=Gt.exports,En=re,Sn=On("keys"),In=function(t){return Sn[t]||(Sn[t]=En(t))},Cn={},Pn=$n,xn=b,An=M,Rn=at,Nn=on,Ln=Vt,kn=Yt,Un=In,jn=Cn,Dn=xn.TypeError,Bn=xn.WeakMap;if(Pn||kn.state){var Gn=kn.state||(kn.state=new Bn),qn=An(Gn.get),Mn=An(Gn.has),Hn=An(Gn.set);hn=function(t,e){if(Mn(Gn,t))throw new Dn("Object already initialized");return e.facade=t,Hn(Gn,t,e),e},yn=function(t){return qn(Gn,t)||{}},vn=function(t){return Mn(Gn,t)}}else{var Kn=Un("state");jn[Kn]=!0,hn=function(t,e){if(Ln(t,Kn))throw new Dn("Object already initialized");return e.facade=t,Nn(t,Kn,e),e},yn=function(t){return Ln(t,Kn)?t[Kn]:{}},vn=function(t){return Ln(t,Kn)}}var Yn={set:hn,get:yn,has:vn,enforce:function(t){return vn(t)?yn(t):hn(t,{})},getterFor:function(t){return function(e){var n;if(!Rn(e)||(n=yn(e)).type!==t)throw Dn("Incompatible receiver, "+t+" required");return n}}},Fn=O,Jn=ot,Qn=Vt,zn=E,Wn=dn.CONFIGURABLE,Xn=_n,Vn=Yn.enforce,Zn=Yn.get,tr=Object.defineProperty,er=zn&&!Fn((function(){return 8!==tr((function(){}),"length",{value:8}).length})),nr=String(String).split("String"),rr=an.exports=function(t,e,n){"Symbol("===String(e).slice(0,7)&&(e="["+String(e).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!Qn(t,"name")||Wn&&t.name!==e)&&tr(t,"name",{value:e,configurable:!0}),er&&n&&Qn(n,"arity")&&t.length!==n.arity&&tr(t,"length",{value:n.arity});try{n&&Qn(n,"constructor")&&n.constructor?zn&&tr(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=Vn(t);return Qn(r,"source")||(r.source=nr.join("string"==typeof e?e:"")),t};Function.prototype.toString=rr((function(){return Jn(this)&&Zn(this).source||Xn(this)}),"toString");var or=ot,ir=on,ar=an.exports,sr=Ht,cr={},ur=Math.ceil,fr=Math.floor,lr=Math.trunc||function(t){var e=+t;return(e>0?fr:ur)(e)},dr=function(t){var e=+t;return e!=e||0===e?0:lr(e)},pr=dr,gr=Math.max,mr=Math.min,hr=dr,yr=Math.min,vr=function(t){return t>0?yr(hr(t),9007199254740991):0},_r=function(t){return vr(t.length)},wr=rt,Tr=function(t,e){var n=pr(t);return n<0?gr(n+e,0):mr(n,e)},br=_r,$r=function(t){return function(e,n,r){var o,i=wr(e),a=br(i),s=Tr(r,a);if(t&&n!=n){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((t||s in i)&&i[s]===n)return t||s||0;return!t&&-1}},Or={includes:$r(!0),indexOf:$r(!1)},Er=Vt,Sr=rt,Ir=Or.indexOf,Cr=Cn,Pr=M([].push),xr=function(t,e){var n,r=Sr(t),o=0,i=[];for(n in r)!Er(Cr,n)&&Er(r,n)&&Pr(i,n);for(;e.length>o;)Er(r,n=e[o++])&&(~Ir(i,n)||Pr(i,n));return i},Ar=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Rr=xr,Nr=Ar.concat("length","prototype");cr.f=Object.getOwnPropertyNames||function(t){return Rr(t,Nr)};var Lr={};Lr.f=Object.getOwnPropertySymbols;var kr=ft,Ur=cr,jr=Lr,Dr=Je,Br=M([].concat),Gr=kr("Reflect","ownKeys")||function(t){var e=Ur.f(Dr(t)),n=jr.f;return n?Br(e,n(t)):e},qr=Vt,Mr=Gr,Hr=$,Kr=qe,Yr=function(t,e,n){for(var r=Mr(e),o=Kr.f,i=Hr.f,a=0;a<r.length;a++){var s=r[a];qr(t,s)||n&&qr(n,s)||o(t,s,i(e,s))}},Fr=O,Jr=ot,Qr=/#|\.prototype\./,zr=function(t,e){var n=Xr[Wr(t)];return n==Zr||n!=Vr&&(Jr(e)?Fr(e):!!e)},Wr=zr.normalize=function(t){return String(t).replace(Qr,".").toLowerCase()},Xr=zr.data={},Vr=zr.NATIVE="N",Zr=zr.POLYFILL="P",to=zr,eo=b,no=$.f,ro=on,oo=function(t,e,n,r){r||(r={});var o=r.enumerable,i=void 0!==r.name?r.name:e;return or(n)&&ar(n,i,r),r.global?o?t[e]=n:sr(e,n):(r.unsafe?t[e]&&(o=!0):delete t[e],o?t[e]=n:ir(t,e,n)),t},io=Ht,ao=Yr,so=to,co=function(t,e){var n,r,o,i,a,s=t.target,c=t.global,u=t.stat;if(n=c?eo:u?eo[s]||io(s,{}):(eo[s]||{}).prototype)for(r in e){if(i=e[r],o=t.dontCallGetSet?(a=no(n,r))&&a.value:n[r],!so(c?r:s+(u?".":"#")+r,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;ao(i,o)}(t.sham||o&&o.sham)&&ro(i,"sham",!0),oo(n,r,i,t)}},uo=S,fo=Function.prototype,lo=fo.apply,po=fo.call,go="object"==typeof Reflect&&Reflect.apply||(uo?po.bind(lo):function(){return po.apply(lo,arguments)}),mo=b,ho=ot,yo=mo.String,vo=mo.TypeError,_o=M,wo=Je,To=function(t){if("object"==typeof t||ho(t))return t;throw vo("Can't set "+yo(t)+" as a prototype")},bo=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=_o(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return wo(n),To(r),e?t(n,r):n.__proto__=r,n}}():void 0),$o=qe.f,Oo=ot,Eo=at,So=bo,Io={};Io[ge("toStringTag")]="z";var Co=b,Po="[object z]"===String(Io),xo=ot,Ao=F,Ro=ge("toStringTag"),No=Co.Object,Lo="Arguments"==Ao(function(){return arguments}()),ko=Po?Ao:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=No(t),Ro))?n:Lo?Ao(e):"Object"==(r=Ao(e))&&xo(e.callee)?"Arguments":r},Uo=ko,jo=b.String,Do=function(t){if("Symbol"===Uo(t))throw TypeError("Cannot convert a Symbol value to a string");return jo(t)},Bo=function(t,e){return void 0===t?arguments.length<2?"":e:Do(t)},Go=at,qo=on,Mo=function(t,e){Go(e)&&"cause"in e&&qo(t,"cause",e.cause)},Ho=Error,Ko=M("".replace),Yo=String(Ho("zxcasd").stack),Fo=/\n\s*at [^:]*:[^\n]*/,Jo=Fo.test(Yo),Qo=function(t,e){if(Jo&&"string"==typeof t&&!Ho.prepareStackTrace)for(;e--;)t=Ko(t,Fo,"");return t},zo=U,Wo=!O((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",zo(1,7)),7!==t.stack)})),Xo=ft,Vo=Vt,Zo=on,ti=lt,ei=bo,ni=Yr,ri=function(t,e,n){n in t||$o(t,n,{configurable:!0,get:function(){return e[n]},set:function(t){e[n]=t}})},oi=function(t,e,n){var r,o;return So&&Oo(r=e.constructor)&&r!==n&&Eo(o=r.prototype)&&o!==n.prototype&&So(t,o),t},ii=Bo,ai=Mo,si=Qo,ci=Wo,ui=E,fi=co,li=go,di=function(t,e,n,r){var o="stackTraceLimit",i=r?2:1,a=t.split("."),s=a[a.length-1],c=Xo.apply(null,a);if(c){var u=c.prototype;if(Vo(u,"cause")&&delete u.cause,!n)return c;var f=Xo("Error"),l=e((function(t,e){var n=ii(r?e:t,void 0),o=r?new c(t):new c;return void 0!==n&&Zo(o,"message",n),ci&&Zo(o,"stack",si(o.stack,2)),this&&ti(u,this)&&oi(o,this,l),arguments.length>i&&ai(o,arguments[i]),o}));l.prototype=u,"Error"!==s?ei?ei(l,f):ni(l,f,{name:!0}):ui&&o in c&&(ri(l,c,o),ri(l,c,"prepareStackTrace")),ni(l,c);try{u.name!==s&&Zo(u,"name",s),u.constructor=l}catch(t){}return l}},pi=b.WebAssembly,gi=7!==Error("e",{cause:7}).cause,mi=function(t,e){var n={};n[t]=di(t,e,gi),fi({global:!0,constructor:!0,arity:1,forced:gi},n)},hi=function(t,e){if(pi&&pi[t]){var n={};n[t]=di("WebAssembly."+t,e,gi),fi({target:"WebAssembly",stat:!0,constructor:!0,arity:1,forced:gi},n)}};function yi(e){try{return t.gzipSync(encodeURIComponent(e)).toString("base64")}catch(t){return"Error: 当前字符串不能被Gzip压缩"}}function vi(e){try{const n=t.unzipSync(Buffer.from(e,"base64")).toString();try{return decodeURIComponent(function(t){return t.replace(/\\u([\d\w]{4})/gi,((t,e)=>String.fromCodePoint(parseInt(e,16))))}(n))}catch(t){return unescape(n)}}catch(t){throw new Error("Error: 当前字符串不能被Gzip解压")}}mi("Error",(function(t){return function(e){return li(t,this,arguments)}})),mi("EvalError",(function(t){return function(e){return li(t,this,arguments)}})),mi("RangeError",(function(t){return function(e){return li(t,this,arguments)}})),mi("ReferenceError",(function(t){return function(e){return li(t,this,arguments)}})),mi("SyntaxError",(function(t){return function(e){return li(t,this,arguments)}})),mi("TypeError",(function(t){return function(e){return li(t,this,arguments)}})),mi("URIError",(function(t){return function(e){return li(t,this,arguments)}})),hi("CompileError",(function(t){return function(e){return li(t,this,arguments)}})),hi("LinkError",(function(t){return function(e){return li(t,this,arguments)}})),hi("RuntimeError",(function(t){return function(e){return li(t,this,arguments)}}));var _i=qe.f,wi=Vt,Ti=ge("toStringTag"),bi=b,$i=function(t,e,n){t&&!n&&(t=t.prototype),t&&!wi(t,Ti)&&_i(t,Ti,{configurable:!0,value:e})};co({global:!0},{Reflect:{}}),$i(bi.Reflect,"Reflect",!0);const Oi=Object.prototype.toString;function Ei(t,e){return Oi.call(t)===`[object ${e}]`}function Si(t){return null!==t&&Ei(t,"Object")}function Ii(t){return Ei(t,"String")}function Ci(t){return"function"==typeof t}function Pi(t){const e=t||xi(),n=e.getFullYear(),r=e.getMonth()+1;return 2===r?n%4==0&&n%100!=0||n%400==0?29:28:[4,6,9,11].includes(r)?30:31}function xi(){const t=new Date,e=t.getTime(),n=t.getTimezoneOffset()/60;return new Date(e+36e5*(n+8))}function Ai(t,e){return Math.ceil(e/t)}function Ri(t=6e4,e){t=t||6e4;const n=xi().getTime()+t,r=new Date(n),o=r.getSeconds(),i=r.getMinutes();return ki({hours:r.getHours(),minutes:i,seconds:o},e)}function Ni(t,e,n){if(n&&"boolean"!=typeof n&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):void 0===e&&(e=t,t=0),t>e){const n=t;t=e,e=n}if(n||t%1||e%1){const n=Math.random();return Math.min(t+n*(e-t+parseFloat("1e-"+((n+"").length-1))),e)}return t+Math.floor(Math.random()*(e-t+1))}function Li(t="17:30:00-23:40:00",e){const n=t.split("-"),r=n[0].split(":").map((t=>+t)),o=n[1].split(":").map((t=>+t)),i=Ni(r[0]??19,o[0]??23);let a=0;a=i==r[0]?Ni(r[1],59):i==o[0]?Ni(o[1]):Ni(59);let s=0;return s=i==r[0]?Ni(r[2],59):i==o[0]?Ni(o[2]):Ni(59),ki({seconds:s,hours:i,minutes:a},e)}function ki({hours:t,minutes:e,seconds:n},r){let o;switch(n=n||0,r){case"scf":default:o=`${n} ${e} ${t} * * * *`;break;case"fc":o=`${n} ${e} ${t} * * *`;break;case"cfc":o=`corn(${e} ${t} * * *)`}return{value:o,string:`${t}:${e}:${n}`}}function Ui(){return`${Ni(1,9)}${function(t,e){let n="";for(let e=0;e<t;e++)n+=Mi("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");return e?n.toLowerCase():n}(10,!0)}0`}function ji(t,e){t.includes(e)||t.push(e)}function Di(t){return t||{}}function Bi(t,e=!1){return"object"!=typeof t?t:Array.isArray(t)?t.map((t=>Bi(t,e))):e?Object.keys(t).reduce(((n,r)=>(n[r]=Bi(t[r],e),n)),{}):Object.assign({},t)}function Gi(t,e){return void 0===t||void 0===e?t||e:Si(t)&&Si(e)?Array.isArray(t)&&Array.isArray(e)?t.concat(e):Object.keys(e).reduce(((n,r)=>(n[r]=Gi(t[r],e[r]),n)),t):e}function qi(t){const e=new URLSearchParams;return Object.keys(t).forEach((n=>{e.append(n,String(t[n]))})),e.toString()}function Mi(t){return t[Ni(t.length-1)]}function Hi(t){return t?t.split("; ").map((t=>t.split("="))):[]}function Ki(t,e){return t?e&&0!==e.length?function(t){const e=Object.keys(t).reduce(((e,n)=>e+`${n}=${t[n]}; `),"");return e.substring(0,e.length-2||0)}(function(t,e){const n=Hi(null==e?void 0:e[0]).filter((t=>2===t.length)),r=Hi(t).concat(n).filter((t=>2===t.length)),o={};for(const t of r)o[t[0]]?o[t[0]]=t[1]:Object.defineProperty(o,t[0],{value:t[1],enumerable:!0,writable:!0});return o}(t,e)):t:""}function Yi(t,e){if(!t)return null;const n=`(?:^|)${e}=([^;]*)(?:;|$)`,r=t.match(n);return r?r[1]:null}function Fi(t){return Yi(t,"bili_jct")||""}function Ji(t){return Yi(t,"LIVE_BUVID")||""}const Qi={value:""},zi={log:Wi,error:function(t){Wi("error",t)},warn:function(t){Wi("warn",t)},info:function(t){Wi("info",t)},verbose:function(t){Wi("verbose",t)},debug:function(t){Wi("debug",t)}};function Wi(t,e){const n=xi().toString().match(/\w{2}:\w{2}:\w{2}/)[0];if(function(t="debug"){const e=["error","warn","info","verbose","debug"],n=e.indexOf(t);return n>0?e.slice(0,n+1):e}().includes(t)){const t=`[${n}] ${e}`;Qi.value+=t+"\n"}process.stdout.write(`[${t} ${n}] ${e}\n`)}const Xi=()=>process.env.QL_BRANCH;class Vi{static configFileName=function(){const t=Xi()?"cat_bili_config":"config",e=".json",{BILITOOLS_FILE_NAME:n}=process.env;return n?n.endsWith(e)?n:`${n}.json`:t+e}();static isQingLongPanel=Xi()}const Zi=m.default?m.default:m;function ta(t){try{let e;if((n.existsSync(t)||n.existsSync(t+="5"))&&(e=n.readFileSync(t,"utf-8")),!e)return;return zi.verbose(`读取配置文件 ${t}`),Zi.parse(e)}catch(t){!function(t){if(!Ii(t))return;throw new TypeError("配置文件存在，但是无法解析！可能 JSON5 格式不正确！")}(t.message)}}const ea=t=>f.resolve(process.cwd(),t),na=t=>f.resolve(__dirname,"../",t);function ra(t){throw new Error(t||"获取配置失败！未找到配置文件！")}const oa=Array.from(new Set([ea("./config/config.dev.json"),ea(`./config/${Vi.configFileName}`),ea(`./${Vi.configFileName}`),na(`./config/${Vi.configFileName}`),na(`./${Vi.configFileName}`)])),ia=["./config.json",ea("./config/config.json")];function aa(t){let e;const n=Array.isArray(t);if(e=n?t:t.account.filter((t=>t.cookie)),0===e.length)return;if(Vi.isQingLongPanel)return function(t){const e=process.argv.find((t=>t.includes("--item")||t.includes("-i")||t.includes("-I")));if(!e)return t[0];const n=Number(e.split("=")[1])-1;return!n||n>=t.length||n<0?(zi.warn("似乎想要指定一个不存在的用户，我们将指定第一个用户"),t[0]):t[n]}(e);zi.warn("在单用户场景下配置了多用户，我们将放弃多余的配置");const r=e[0];return n||(r.message=Object.assign(t.message||{},r.message)),r}function sa(){if(globalThis.BILITOOLS_CONFIG)return globalThis.BILITOOLS_CONFIG;Vi.isQingLongPanel&&oa.splice(0,1,...ia);for(let t=0;t<oa.length;t++){const e=ta(oa[t]);if(e)return e}return(()=>{const{BILITOOLS_CONFIG:t,BILI_SCF_CONFIG:e,BILI_CONFIG:n}=process.env,r=t||e||n;if(r)try{return Zi.parse(vi(r))}catch{ra("环境中的配置不是有效的 JSON 字符串！")}})()}function ca(t){if(t||ra(),function(t){if(Array.isArray(t))return!0;return Boolean(t.account&&t.account.length)}(t)){const e=aa(t);if(e)return e}return t.cookie||ra("配置文件中没有 cookie！"),t}function ua(t){return t&&t.map((t=>Number(t))).filter((t=>t>0&&t%1==0))}class fa{constructor(t){var e;this.config=t,this.COOKIE=t.cookie,this.BILIJCT=Fi(t.cookie),this.USERID=(e=t.cookie,Number(Yi(e,"DedeUserID"))||0),this.USER_AGENT=t.userAgent;const n=t.apiDelay??[2,6];this.BILI_API_DELAY=Array.isArray(n)?ua(n):[Number(n)];const r=Di(t.message);this.MESSAGE_API=r.api,this.PUSHPLUS_TOKEN=r.pushplusToken||process.env.PUSHPLUS_TOKEN;const o=Di(t.coin);this.BILI_CUSTOMIZE_UP=ua(o.customizeUp||t.customizeUp)||[],this.BILI_UPPER_ACC_MATCH=!1!==(o.upperAccMatch??t.upperAccMatch),this.BILI_COIN_RETRY_NUM=o.retryNum||t.coinRetryNum||4,this.BILI_TARGET_LEVEL=(o.targetLevel||t.targetLevel)??6,this.BILI_STAY_COINS=(o.stayCoins||t.stayCoins)??0,this.BILI_TARGET_COINS=(o.targetCoins||t.targetCoins)??5;const i=Di(t.gift);this.BILI_GIFT_UP=ua(i.mids||t.giftUp)||this.BILI_CUSTOMIZE_UP||[];const a=Di(t.charge);this.CHARGE_ID=a.mid||t.chargeUpId||this.USERID,this.CHARGE_PRESET_TIME=a.presetTime||t.chargePresetTime||31;const s=Di(t.match);this.MATCH_COINS=(s.coins||t.matchCoins)??5,this.MATCH_SELECTION=(s.selection||t.matchSelection)??1,this.MATCH_DIFF=(s.diff||t.matchDiff)??0;const c=Di(t.lottery);this.LOTTERY_EXCLUDE=c.excludeAward||y,this.LOTTERY_INCLUDE=c.includeAward||v,this.LOTTERY_UP_BLACKLIST=c.blackUid||_,this.LOTTERY_MOVE_TAG=c.moveTag,this.LOTTERY_PAGE_NUM=c.pageNum||2}}let la;const da=new Proxy({},{get:(t,e)=>(la||ga(),Reflect.get(la,e)),set:(t,e,n)=>"config"===e&&n?(ga(n),!0):Reflect.set(la,e,n)});let pa=null;function ga(t){t||(t=ca(sa())),la=new fa(ca(t)),pa=class extends class{static money=0;static coinsTask=5;static share=!1;static watch=!1;static currentStartFun=0;static bCoinCouponBalance=0;static vipType=0;static userLevel=0}{},pa.coinsTask=la.BILI_TARGET_COINS}function ma(t){const e=da.BILI_API_DELAY;let n;n=1===e.length?1e3*e[0]:1e3*Ni(e[0]||2,e[1]||6),n=t||n;const r=(new Date).getTime()+parseInt(n,10);for(;(new Date).getTime()<r;);return new Promise((t=>{t("done")}))}var ha=!O((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),ya=b,va=Vt,_a=ot,wa=zt,Ta=ha,ba=In("IE_PROTO"),$a=ya.Object,Oa=$a.prototype,Ea=Ta?$a.getPrototypeOf:function(t){var e=wa(t);if(va(e,ba))return e[ba];var n=e.constructor;return _a(n)&&e instanceof n?n.prototype:e instanceof $a?Oa:null},Sa={},Ia=xr,Ca=Ar,Pa=Object.keys||function(t){return Ia(t,Ca)},xa=E,Aa=Me,Ra=qe,Na=Je,La=rt,ka=Pa;Sa.f=xa&&!Aa?Object.defineProperties:function(t,e){Na(t);for(var n,r=La(e),o=ka(e),i=o.length,a=0;i>a;)Ra.f(t,n=o[a++],r[n]);return t};var Ua,ja=ft("document","documentElement"),Da=Je,Ba=Sa,Ga=Ar,qa=Cn,Ma=ja,Ha=Pe,Ka=In("IE_PROTO"),Ya=function(){},Fa=function(t){return"<script>"+t+"<\/script>"},Ja=function(t){t.write(Fa("")),t.close();var e=t.parentWindow.Object;return t=null,e},Qa=function(){try{Ua=new ActiveXObject("htmlfile")}catch(t){}var t,e;Qa="undefined"!=typeof document?document.domain&&Ua?Ja(Ua):((e=Ha("iframe")).style.display="none",Ma.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Fa("document.F=Object")),t.close(),t.F):Ja(Ua);for(var n=Ga.length;n--;)delete Qa.prototype[Ga[n]];return Qa()};qa[Ka]=!0;var za=Object.create||function(t,e){var n;return null!==t?(Ya.prototype=Da(t),n=new Ya,Ya.prototype=null,n[Ka]=t):n=Qa(),void 0===e?n:Ba.f(n,e)},Wa=Nt,Xa=S,Va=M(M.bind),Za={},ts=Za,es=ge("iterator"),ns=Array.prototype,rs=ko,os=kt,is=Za,as=ge("iterator"),ss=function(t){if(null!=t)return os(t,as)||os(t,"@@iterator")||is[rs(t)]},cs=P,us=Nt,fs=Je,ls=Pt,ds=ss,ps=b.TypeError,gs=P,ms=Je,hs=kt,ys=function(t,e){return Wa(t),void 0===e?t:Xa?Va(t,e):function(){return t.apply(e,arguments)}},vs=P,_s=Je,ws=Pt,Ts=function(t){return void 0!==t&&(ts.Array===t||ns[es]===t)},bs=_r,$s=lt,Os=function(t,e){var n=arguments.length<2?ds(t):e;if(us(n))return fs(cs(n,t));throw ps(ls(t)+" is not iterable")},Es=ss,Ss=function(t,e,n){var r,o;ms(t);try{if(!(r=hs(t,"return"))){if("throw"===e)throw n;return n}r=gs(r,t)}catch(t){o=!0,r=t}if("throw"===e)throw n;if(o)throw r;return ms(r),n},Is=b.TypeError,Cs=function(t,e){this.stopped=t,this.result=e},Ps=Cs.prototype,xs=function(t,e,n){var r,o,i,a,s,c,u,f=n&&n.that,l=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),g=ys(e,f),m=function(t){return r&&Ss(r,"normal",t),new Cs(!0,t)},h=function(t){return l?(_s(t),p?g(t[0],t[1],m):g(t[0],t[1])):p?g(t,m):g(t)};if(d)r=t;else{if(!(o=Es(t)))throw Is(ws(t)+" is not iterable");if(Ts(o)){for(i=0,a=bs(t);a>i;i++)if((s=h(t[i]))&&$s(Ps,s))return s;return new Cs(!1)}r=Os(t,o)}for(c=r.next;!(u=vs(c,r)).done;){try{s=h(u.value)}catch(t){Ss(r,"throw",t)}if("object"==typeof s&&s&&$s(Ps,s))return s}return new Cs(!1)},As=co,Rs=b,Ns=lt,Ls=Ea,ks=bo,Us=Yr,js=za,Ds=on,Bs=U,Gs=Qo,qs=Mo,Ms=xs,Hs=Bo,Ks=Wo,Ys=ge("toStringTag"),Fs=Rs.Error,Js=[].push,Qs=function(t,e){var n,r=arguments.length>2?arguments[2]:void 0,o=Ns(zs,this);ks?n=ks(new Fs,o?Ls(this):zs):(n=o?this:js(zs),Ds(n,Ys,"Error")),void 0!==e&&Ds(n,"message",Hs(e)),Ks&&Ds(n,"stack",Gs(n.stack,1)),qs(n,r);var i=[];return Ms(t,Js,{that:i}),Ds(n,"errors",i),n};ks?ks(Qs,Fs):Us(Qs,Fs,{name:!0});var zs=Qs.prototype=js(Fs.prototype,{constructor:Bs(1,Qs),message:Bs(1,""),name:Bs(1,"AggregateError")});As({global:!0,constructor:!0,arity:2},{AggregateError:Qs});var Ws={},Xs=Nt,Vs=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=Xs(e),this.reject=Xs(n)};Ws.f=function(t){return new Vs(t)};var Zs,tc=P,ec=Nt,nc=ft,rc=Ws,oc=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},ic=xs;co({target:"Promise",stat:!0},{any:function(t){var e=this,n=nc("AggregateError"),r=rc.f(e),o=r.resolve,i=r.reject,a=oc((function(){var r=ec(e.resolve),a=[],s=0,c=1,u=!1;ic(t,(function(t){var f=s++,l=!1;c++,tc(r,e,t).then((function(t){l||u||(u=!0,o(t))}),(function(t){l||u||(l=!0,a[f]=t,--c||i(new n(a,"No one promise resolved")))}))})),--c||i(new n(a,"No one promise resolved"))}));return a.error&&i(a.value),r.promise}}),function(t){t[t.SUCCESS=0]="SUCCESS",t[t["应用程序不存在或已被封禁"]=-1]="应用程序不存在或已被封禁",t[t["Access Key错误"]=-2]="Access Key错误",t[t["API校验密匙错误"]=-3]="API校验密匙错误",t[t["调用方对该Method没有权限"]=-4]="调用方对该Method没有权限",t[t["账号未登录"]=-101]="账号未登录",t[t["账号被封停"]=-102]="账号被封停",t[t["积分不足"]=-103]="积分不足",t[t["硬币不足"]=-104]="硬币不足",t[t["验证码错误"]=-105]="验证码错误",t[t["账号非正式会员或在适应期"]=-106]="账号非正式会员或在适应期",t[t["应用不存在或者被封禁"]=-107]="应用不存在或者被封禁",t[t["未绑定手机?"]=-108]="未绑定手机?",t[t["未绑定手机"]=-110]="未绑定手机",t[t["csrf 校验失败"]=-111]="csrf 校验失败",t[t["系统升级中"]=-112]="系统升级中",t[t["账号尚未实名认证"]=-113]="账号尚未实名认证",t[t["请先绑定手机"]=-114]="请先绑定手机",t[t["请先完成实名认证"]=-115]="请先完成实名认证"}(Zs||(Zs={}));const ac="GET",sc=new Map,cc=t=>[t.method,t.url].join("&");class uc{addPending(t){this.removePending(t);const e=cc(t);t.cancelToken||(t.cancelToken=new l.default.CancelToken((t=>{sc.has(e)||sc.set(e,t)})))}removeAllPending(){sc.forEach((t=>{t&&Ci(t)&&t()})),sc.clear()}removePending(t){const e=cc(t);if(sc.has(e)){const t=sc.get(e);t&&Ci(t)&&t(),sc.delete(e)}}reset(){sc.clear()}}class fc{constructor(t){const{requestOptions:e}=t;!1===e.withCredentials&&(t.withCredentials=!1),this.options=t,this.axiosInstance=l.default.create(t),this.setupInterceptors()}createAxiosInstance(t){this.axiosInstance=l.default.create(t)}getTransform(){return this.options.transform}getAxios(){return this.axiosInstance}configAxios(t){this.axiosInstance&&this.createAxiosInstance(t)}setHeaders(t){this.axiosInstance&&Object.assign(this.axiosInstance.defaults.headers,this.options.headers,t)}setupInterceptors(){const t=this.getTransform();if(!t)return;const{requsetInterceptors:e,requestInterceptorsCatch:n,responseInterceptors:r,responseInterceptorsCatch:o}=t,i=new uc;this.axiosInstance.interceptors.request.use((t=>{var n;const{headers:{ignoreCancelToken:o}}=t;return!(o||(null===(n=this.options.requestOptions)||void 0===n?void 0:n.ignoreCancelToken))&&i.addPending(t),Ci(r)&&(t=e(t,this.options)),t}),void 0),Ci(n)&&this.axiosInstance.interceptors.request.use(void 0,n),this.axiosInstance.interceptors.response.use((t=>(t&&i.removePending(t.config),Ci(r)&&(t=r(t)),t)),void 0),Ci(o)&&this.axiosInstance.interceptors.response.use(void 0,o)}supportFormData(t){var e;const n={...this.options.headers,...t.headers};return((null==n?void 0:n["Content-Type"])||(null==n?void 0:n["content-type"])||"").includes("application/x-www-form-urlencoded")&&Reflect.has(t,"data")&&(null===(e=t.method)||void 0===e?void 0:e.toUpperCase())!==ac&&!Ii(t.data)?{...t,data:qi(t.data)}:t}get(t,e){return Ii(t)?this.request({...e,method:"GET",url:t}):this.request({...t,method:"GET"})}post(t,e,n){return Ii(t)?this.request({...n,method:"POST",url:t,data:e}):this.request({...t,method:"POST"})}put(t,e,n){return this.request({...n,method:"PUT",url:t,data:e})}delete(t,e,n){return this.request({...n,method:"DELETE",url:t,data:e})}patch(t,e,n){return this.request({...n,method:"PATCH",url:t,data:e})}request(t){let e=Bi(t,!0);const n=this.getTransform(),{requestOptions:r}=this.options,o=Object.assign({},r,t.requestOptions),{beforeRequestHook:i,requestCatchHook:a,transformRequestHook:s}=n||{};return Ci(i)&&(e=i(e,o)),e.requestOptions=o,e=this.supportFormData(e),new Promise(((t,n)=>{this.axiosInstance.request(e).then((e=>{if(Ci(s))try{const n=s(e,o);t(n)}catch(t){n(t||new Error("请求错误!"))}else t(e)})).catch((t=>{Ci(a)?n(a(t,o)):n(t)}))}))}}const lc="https://account.bilibili.com",dc="https://live.bilibili.com",pc="https://space.bilibili.com",gc="https://www.bilibili.com/",mc="https://account.bilibili.com",hc="https://api.live.bilibili.com",yc="https://api.bilibili.com",vc="https://manga.bilibili.com",_c="https://api.vc.bilibili.com",wc={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.41 Safari/537.36 Edg/101.0.1210.32","content-type":"application/x-www-form-urlencoded; charset=UTF-8","accept-language":"zh-CN,zh;q=0.9"};var Tc=[["/twirp/activity.v1.Activity/ClockIn","ERR_BAD_REQUEST"]];const bc={transformRequestHook:(t,e)=>{const{isTransformResponse:n,isReturnNativeResponse:r}=e;if(r)return t;if(!n)return t.data;const{data:o}=t;return e.isJsonp&&Ii(o)?function(t){const e=t.replace(/^\w+\(/,"").replace(/\)$/,"");return JSON.parse(e)}(o):o},beforeRequestHook:(t,e)=>{var n;const{apiUrl:r}=e;r&&Ii(r)&&(t.url.startsWith("/")&&r.endsWith("/")?t.url=r+t.url.substring(1):t.url.startsWith("/")||r.endsWith("/")?t.url=`${r}${t.url}`:t.url=`${r}/${t.url}`);const o=t.params||{},i=t.data||!1;return(null===(n=t.method)||void 0===n?void 0:n.toUpperCase())!==ac&&(Ii(o)?(t.url=t.url+o,t.params=void 0):Reflect.has(t,"data")&&t.data?(t.data=i,t.params=o):(t.data=o,t.params=void 0)),t},requsetInterceptors:t=>{const{requestOptions:e}=t;return!0===e.withBiliCookie&&(t.headers.Cookie=da.COOKIE),t},responseInterceptors:t=>{var e;t.config.requestOptions.withBiliCookie&&(da.COOKIE=Ki(da.COOKIE,(null===(e=t.headers)||void 0===e?void 0:e["set-cookie"])||[]));return t},responseInterceptorsCatch:async t=>{const{requestOptions:e,url:n}=t.config;return Tc.find((e=>e[0]===n&&e[1]===t.code))||0===e.retry?Promise.reject(t):(e.retry||(e.retry=2),e.__retryCount=e.__retryCount||0,e.__retryCount>=e.retry?Promise.reject(t):(e.__retryCount+=1,await ma(e.retryDelay||100),await Ec.request(t.config)))}};function $c(t){return new fc(Gi({timeout:1e4,headers:{"Content-Type":wc["content-type"],"User-Agent":wc["user-agent"],"accept-language":wc["accept-language"]},transform:bc,requestOptions:{isReturnNativeResponse:!1,isTransformResponse:!0,ignoreCancelToken:!0,retry:2,withBiliCookie:!0},withCredentials:!0},t||{}))}const Oc=$c({requestOptions:{withBiliCookie:!1}}),Ec=$c();const Sc=async t=>{zi.info(t||"阿里云 FC 测试ing")};async function Ic(t,e){Sc();const{dailyHandle:n}=await Promise.resolve().then((function(){return Af}));return await n({event:t,context:e,slsType:"fc"})}async function Cc(t,e){Sc("功能开发中，敬请期待");const{liveHeartHandle:n}=await Promise.resolve().then((function(){return Af}));return await n({event:t,context:e,slsType:"fc"})}zi.info("开始执行网络代码"),zi.info("当前版本【v0.4.13】"),(async()=>{const t=JSON.parse(event.toString());let e=Ic;"heart_bili_timer"===t.triggerName&&(e=Cc),e(t,context).then((t=>{VMThis.message=t,VMThis.resolve(VMThis.message)})).catch((t=>{VMThis.error=t,VMThis.reject(VMThis.error)}))})();const Pc={silver2Coin:!0,liveSignTask:!0,addCoins:!0,mangaSign:!1,shareAndWatch:!0,supGroupSign:!1,liveSendMessage:!1,taskReward:!0,charging:!1,getVipPrivilege:!1,giveGift:!1,matchGame:!1,liveLottery:!1};function xc(){return{...Pc}}function Ac(t){const e=function(){const t=xc();for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const n=t[e];switch((da.config.function||{})[e]){case!0:!1===n&&(t[e]=!0);break;case!1:!0===n&&(t[e]=!1)}}return t.addCoins||t.shareAndWatch||(t.taskReward=!1),t}();return t.map((t=>e[t.name]?t:null)).filter((t=>t))}function Rc(){var t;const e=(null===(t=da.config)||void 0===t?void 0:t.message)||{};["GOBOT_URL","GOBOT_TOKEN","GOBOT_QQ","SCKEY","QQ_SKEY","QQ_MODE","BARK_PUSH","BARK_SOUND","BARK_GROUP","TG_BOT_TOKEN","TG_USER_ID","TG_PROXY_AUTH","TG_PROXY_HOST","TG_PROXY_PORT","TG_API_HOST","DD_BOT_TOKEN","DD_BOT_SECRET","QYWX_KEY","QYWX_AM","IGOT_PUSH_KEY","PUSH_PLUS_TOKEN","PUSH_PLUS_USER"].forEach((t=>{const n=e[(r=t,r.toLowerCase().replace(/_(\w)/g,((t,e)=>e.toUpperCase())))]||e[t]||process.env[t];var r;n&&(process.env[t]=n)})),da.PUSHPLUS_TOKEN&&(process.env.PUSH_PLUS_TOKEN=da.PUSHPLUS_TOKEN),function(){process.env.PUSH_KEY&&(Nc=process.env.PUSH_KEY);process.env.QQ_SKEY&&(Wc=process.env.QQ_SKEY);process.env.QQ_MODE&&(Xc=process.env.QQ_MODE);process.env.BARK_PUSH?(Lc=process.env.BARK_PUSH.indexOf("https")>-1||process.env.BARK_PUSH.indexOf("http")>-1?process.env.BARK_PUSH:`https://api.day.app/${process.env.BARK_PUSH}`,process.env.BARK_SOUND&&(kc=process.env.BARK_SOUND),process.env.BARK_GROUP&&(Uc=process.env.BARK_GROUP)):Lc&&-1===Lc.indexOf("https")&&-1===Lc.indexOf("http")&&(Lc=`https://api.day.app/${Lc}`);process.env.TG_BOT_TOKEN&&(jc=process.env.TG_BOT_TOKEN);process.env.TG_USER_ID&&(Dc=process.env.TG_USER_ID);process.env.TG_PROXY_AUTH&&(qc=process.env.TG_PROXY_AUTH);process.env.TG_PROXY_HOST&&(Bc=process.env.TG_PROXY_HOST);process.env.TG_PROXY_PORT&&(Gc=process.env.TG_PROXY_PORT);process.env.TG_API_HOST&&(Mc=process.env.TG_API_HOST);process.env.DD_BOT_TOKEN&&(Hc=process.env.DD_BOT_TOKEN,process.env.DD_BOT_SECRET&&(Kc=process.env.DD_BOT_SECRET));process.env.QYWX_KEY&&(Yc=process.env.QYWX_KEY);process.env.QYWX_AM&&(Fc=process.env.QYWX_AM);process.env.IGOT_PUSH_KEY&&(Jc=process.env.IGOT_PUSH_KEY);process.env.PUSH_PLUS_TOKEN&&(Qc=process.env.PUSH_PLUS_TOKEN);process.env.PUSH_PLUS_USER&&(zc=process.env.PUSH_PLUS_USER)}()}let Nc="",Lc="",kc="",Uc="QingLong",jc="",Dc="",Bc="",Gc="",qc="",Mc="api.telegram.org",Hc="",Kc="",Yc="",Fc="",Jc="",Qc="",zc="",Wc="",Xc="";async function Vc(t,e){var n;const r=null===(n=da.config.message)||void 0===n?void 0:n.email;if(!(r&&r.pass&&r.from&&r.host))return;const o=Number(r.port)||465,i=d.createTransport({host:r.host,port:o,secure:465===o,auth:{user:r.from,pass:r.pass}}),a=await i.sendMail({from:`${t} <${r.from}>`,to:r.to,subject:t,headers:{"Content-Type":"text/plain; charset=utf-8"},text:e.replace(/\n/g,"\r\n")});zi.info(`邮件消息已发送: ${a.messageId}`)}async function Zc(t,e){try{const n=da.MESSAGE_API;if(!n)return;const r=n.replace("{title}",t).replace("{text}",e);await Oc.get(r)}catch(t){zi.info(`自定义接口消息发送失败: ${t}`),zi.error(t)}}function tu(t,e,n=2100){return new Promise((r=>{if(Nc){e=e.replace(/[\n\r]/g,"\n\n");const o={url:Nc.includes("SCT")?`https://sctapi.ftqq.com/${Nc}.send`:`https://sc.ftqq.com/${Nc}.send`,params:`text=${t}&desp=${e}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};setTimeout((()=>{Oc.post(o).then((t=>{0===t.errno||0===t.data.errno?zi.info("server酱发送通知消息成功🎉"):1024===t.errno?zi.info(`server酱发送通知消息异常: ${t.errmsg}`):zi.info(`server酱发送通知消息异常\n${JSON.stringify(t)}`)})).catch((t=>{zi.info("发送通知调用API失败！！"),zi.info(t)})).finally((()=>{r("")}))}),n)}else r("")}))}function eu(t,e){return new Promise((n=>{if(Wc){const r={url:`https://push.xuthus.cc/${Xc}/${Wc}`,headers:{"Content-Type":"application/json"},data:{},params:{}};t=t.replace(/京豆/g,"豆豆"),e=(e=(e=e.replace(/京豆/g,"")).replace(/🐶/g,"")).replace(/红包/g,"H包"),"email"===Xc?r.data={t:t,c:e}:r.params=`${t}\n\n${e}`;const o=function(t){switch(t){case"send":return"个人";case"group":return"QQ群";case"wx":return"微信";case"ww":return"企业微信";case"email":return"邮件";default:return"未知方式"}};Oc.post(r).then((t=>{200===t.code?zi.info(`酷推发送${o(Xc)}通知消息成功🎉`):400===t.code?zi.info(`QQ酷推(Cool Push)发送${o(Xc)}推送失败：${t.msg}`):503===t.code?zi.info(`QQ酷推出错，${t.message}：${t.data}`):zi.info(`酷推推送异常: ${JSON.stringify(t)}`)})).catch((t=>{zi.info(`发送${o(Xc)}通知调用API失败！！`),zi.info(t)})).finally((()=>{n("")}))}else n("")}))}function nu(t,e,n={}){return new Promise((r=>{if(Lc){const o={url:`${Lc}/${encodeURIComponent(t)}/${encodeURIComponent(e)}?sound=${kc}&group=${Uc}&${qi(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};Oc.get(o).then((t=>{200===t.code?zi.info("Bark APP发送通知消息成功🎉"):zi.info(`Bark APP发送通失败：${t.message}`)})).catch((t=>{zi.info("Bark APP发送通知调用API失败！！"),zi.error(t)})).finally((()=>{r("")}))}r("")}))}function ru(t,e){return new Promise((n=>{if(jc&&Dc){const r={url:`https://${Mc}/bot${jc}/sendMessage`,params:`chat_id=${Dc}&text=${t}\n\n${e}&disable_web_page_preview=true`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};if(Bc&&Gc){const t=p.httpsOverHttp({proxy:{host:Bc,port:+Gc,proxyAuth:qc}});Object.assign(r,{httpsAgent:t})}Oc.post(r).then((t=>{t.ok?zi.info("Telegram发送通知消息成功🎉。"):400===t.error_code?zi.info("请主动给bot发送一条消息并检查接收用户ID是否正确。"):401===t.error_code&&zi.info("Telegram bot token 填写错误。")})).catch((t=>{zi.info("telegram发送通知消息失败！！"),zi.info(t)})).finally((()=>{n("")}))}else n("")}))}function ou(t,e){return new Promise((n=>{const r={url:`https://oapi.dingtalk.com/robot/send?access_token=${Hc}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};if(Hc){if(Kc){const t=require("crypto"),e=Date.now(),n=t.createHmac("sha256",Kc);n.update(`${e}\n${Kc}`);const o=encodeURIComponent(n.digest("base64"));r.url=`${r.url}&timestamp=${e}&sign=${o}`}Oc.post(r).then((t=>{0===t.errcode?zi.info("钉钉发送通知消息成功🎉。"):zi.info(`钉钉发送通知失败：${t.errmsg}`)})).catch((t=>{zi.info("钉钉发送通知消息失败！！"),zi.info(t)})),n("")}else n("")}))}function iu(t,e){return new Promise((n=>{const r={url:`https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${Yc}`,data:{msgtype:"text",text:{content:` ${t}\n\n${e}`}},headers:{"Content-Type":"application/json"},timeout:15e3};Yc&&Oc.post(r).then((t=>{0===t.errcode?zi.info("企业微信发送通知消息成功🎉。"):zi.info(`企业微信发送通知失败：${t.errmsg}`)})).catch((t=>{zi.info("企业微信发送通知消息失败！！"),zi.info(t)})).finally((()=>{n("")})),n("")}))}function au(t){const e=Fc.split(",");if(e[2]){const n=e[2].split("|");let r="";for(let e=0;e<n.length;e++){const o="签到号 "+(e+1);t.match(o)&&(r=n[e])}return r||(r=e[2]),r}return"@all"}function su(t,e){return new Promise((n=>{if(Fc){const r=Fc.split(","),o={url:"https://qyapi.weixin.qq.com/cgi-bin/gettoken",data:{corpid:`${r[0]}`,corpsecret:`${r[1]}`},headers:{"Content-Type":"application/json"},timeout:15e3};Oc.post(o).then((o=>{const i=e.replace(/\n/g,"<br/>"),a=JSON.parse(o).access_token;let s;switch(r[4]){case"0":s={msgtype:"textcard",textcard:{title:`${t}`,description:`${e}`,url:"https://github.com/whyour/qinglong",btntxt:"更多"}};break;case"1":s={msgtype:"text",text:{content:`${t}\n\n${e}`}};break;default:s={msgtype:"mpnews",mpnews:{articles:[{title:`${t}`,thumb_media_id:`${r[4]}`,author:"智能助手",content_source_url:"",content:`${i}`,digest:`${e}`}]}}}r[4]||(s={msgtype:"text",text:{content:`${t}\n\n${e}`}}),s={url:`https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${a}`,data:{touser:`${au(e)}`,agentid:`${r[3]}`,safe:"0",...s},headers:{"Content-Type":"application/json"}},Oc.post(s).then((t=>{0===t.errcode?zi.info("成员ID:"+au(e)+"企业微信应用消息发送通知消息成功🎉。"):zi.info(`企业微信应用：${t.errmsg}`)})).catch((t=>{zi.info("成员ID:"+au(e)+"企业微信应用消息发送通知消息失败！！"),zi.info(t)})).finally((()=>{n("")}))})).catch((t=>{zi.error("企业微信应用消息发送通知消息失败！！")}))}else n("")}))}function cu(t,e,n={}){return new Promise((r=>{if(Jc){if(!new RegExp("^[a-zA-Z0-9]{24}$").test(Jc))return zi.info("您所提供的IGOT_PUSH_KEY无效"),void r("");const o={url:`https://push.hellyw.com/${Jc.toLowerCase()}`,params:`title=${t}&content=${e}&${qi(n)}`,headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3};Oc.post(o).then((t=>{"string"==typeof t&&(t=JSON.parse(t)),0===t.ret?zi.info("iGot发送通知消息成功🎉"):zi.info(`iGot发送通知消息失败：${t.errMsg}`)})).catch((t=>{zi.info("发送通知调用API失败！！"),zi.info(t)})).finally((()=>{r("")}))}else r("")}))}function uu(t,e){return new Promise((n=>{if(Qc){e=e.replace(/[\n\r]/g,"<br>");const r={url:"https://www.pushplus.plus/send",params:{token:`${Qc}`,title:`${t}`,content:`${e}`,topic:`${zc}`},headers:{"Content-Type":" application/json"},timeout:15e3};Oc.post(r).then((t=>{200===t.code?zi.info(`push+发送${zc?"一对多":"一对一"}通知消息完成。`):zi.info(`push+发送${zc?"一对多":"一对一"}通知消息失败：${t.msg}`)})).catch((t=>{zi.info(`push+发送${zc?"一对多":"一对一"}通知消息失败！！`),zi.info(t)})).finally((()=>{n("")}))}else n("")}))}async function fu(t,e){zi.info("----【消息推送】----"),t=`Bili-${pa.nickname}-${t}`,await async function(t,e,n={},r){Rc(),e+=r,await Promise.all([tu(t,e),uu(t,e)]),await Promise.all([nu(t,e,n),ru(t,e),ou(t,e),iu(t,e),su(t,e),cu(t,e,n),Vc(t,e),Zc(t,e),eu(t,e)])}(t,e,void 0,"")}const lu=$c({baseURL:mc,headers:{"User-Agent":da.USER_AGENT}}),du=$c({baseURL:hc,headers:{Referer:gc,"User-Agent":da.USER_AGENT}}),pu=$c({baseURL:yc,headers:{Referer:gc,"User-Agent":da.USER_AGENT}}),gu=$c({baseURL:vc,headers:{"User-Agent":da.USER_AGENT}}),mu=$c({baseURL:_c,headers:{"User-Agent":da.USER_AGENT}});function hu(t=3394945){const e=(new Date).getTime();return du.get(`/xlive/web-room/v1/gift/bag_list?t=${e}&room_id=${t}`)}function yu(t=1,e=10){return t>10&&(t=10),du.get(`/xlive/app-ucenter/v1/user/GetMyMedals?page=${t}&page_size=${e}`)}function vu({ruid:t,gift_num:e,bag_id:n,gift_id:r,roomid:o}){const i=da.BILIJCT,a=i,s={gift_id:r,ruid:t,gift_num:e,bag_id:n,biz_id:o,rnd:(new Date).getTime(),send_ruid:0,storm_beat_id:0,metadata:"",price:0,visit_id:"",csrf:i,platform:"pc",biz_code:"Live",csrf_token:a,uid:da.USERID};return du.post("/xlive/revenue/v2/gift/sendBag",s,{headers:{Origin:dc}})}function _u(){return pu.get("/x/web-interface/nav",{headers:{Origin:lc}})}function wu(){return pu.get("/x/web-interface/coin/today/exp")}function Tu(t=1,e=50,n){return pu.get("/x/relation/tag",{params:{tagid:n,pn:t,ps:e}})}function bu(t,e){return pu.post("/x/relation/tags/addUsers?cross_domain=true",{fids:t,tagids:e,csrf:da.BILIJCT},{headers:{Origin:pc}})}function $u(t){const e=t.level_info,n=e.current_level;if(n>=da.BILI_TARGET_LEVEL&&(pa.coinsTask=0),zi.info(`当前等级: ${e.current_level}`),n>=6){const t=da.config.function;t.shareAndWatch=!1,t.addCoins=!1,t.taskReward=!1,zi.info("已经满级，不需要再投币了，做个白嫖怪吧")}else{const t=e.next_exp-e.current_exp;zi.info(`距离升级还需要 ${t} 经验，预计 ${function(t){if(da.BILI_TARGET_COINS<=0)return t/15;const e=10*da.BILI_TARGET_COINS+15,n=t/e,r=pa.money/(da.BILI_TARGET_COINS-1);return n<r?Math.floor(n):(t-r*e)/25+r}(t).toFixed(2)} 天`)}}async function Ou(t){try{var e;const{data:n}=await lu.get("/site/getCoin");zi.info(`登录成功: ${t.uname}`),zi.info(`硬币余额: ${n.money||0}`),pa.nickname=function(t){const e=t.length;return e<=3?t:`${t[0]}**${t[e-1]}`}(t.uname),pa.money=n.money||0,pa.userLevel=t.level_info.current_level,pa.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0,$u(t),function(t){let e="";switch(pa.vipType=t.vipType,t.vipType){case 0:e="无大会员";break;case 1:e="月度大会员";break;case 2:e="年度大会员"}0===t.vipStatus&&(e="无大会员"===e?e:e+"[已过期]"),zi.info(`大会员状态: ${e}`)}(t)}catch(t){zi.error(`获取硬币信息异常: ${t.message}`),zi.debug(t)}}function Eu(t,e,n=1){return pu.post("/x/web-interface/coin/add",{aid:t,multiply:e,selectLike:n,csrf:da.BILIJCT})}function Su(t,e=1){return Ec.post("https://www.bilibili.com/audio/music-service-c/web/coin/add",{sid:t,multiply:e,csrf:da.BILIJCT})}const Iu="video",Cu="audio",Pu="article";async function xu(t=!0){try{const r=da.USERID,{data:o,message:i,code:a}=await(t?Tu(e,n,-10):function(t,e,n,r,o){return pu.get("/x/relation/followings",{params:{vmid:t,pn:e,ps:n,order:r,order_type:o}})}(r)),s=t?o:o.list;if(!s||0===s.length)return{msg:"-1",data:{}};if(0===a){await ma();const{mid:t}=Mi(s)||{};return await Nu(t)}return{msg:t?`未获取到特别关注列表: ${a}-${i}`:`未获取到关注列表: ${a}-${i}`,data:{}}}catch(t){return{msg:t.message,data:{}}}var e,n}async function Au(){const t=Mi([1,3,4,5,160,22,119]);try{const{data:e,message:n,code:r}=await function(t,e){return pu.get("/x/web-interface/ranking/region",{params:{rid:t,day:e}})}(t,3);if(0==r){const{aid:t,title:n,author:r}=Mi(e);return{msg:"0",data:{id:Number(t),title:n,author:r}}}return{msg:`未获取到排行信息: ${r}-${n}`,data:{}}}catch(t){return{msg:t.message,data:{}}}}async function Ru(){const t=da.BILI_CUSTOMIZE_UP;return 0===t.length?{msg:"-1",data:{}}:await Nu(Mi(t))}async function Nu(t){try{const{code:e,data:n,message:r}=await function(t){return pu.get(`/x/space/navnum?mid=${t}`)}(t);if(e)return{msg:`通过uid获取视频失败: ${e}-${r}`,data:{}};await ma();const{video:o,audio:i,article:a}=n,{type:s,page:c,index:u}=function([t,e,n]){const r=t+e+n;if(!r)return;const o=Ni(0,r-1);let i=o;if(o<t)return{type:Iu,page:Ai(30,i+1),index:i%30};const a=t+e;return i=o-t,o<a?{type:Cu,page:Ai(30,i+1),index:i%30}:(i=o-a,{type:Pu,page:Ai(12,i+1),index:i%12})}([o,i,a]),f={[Iu]:Lu,[Cu]:ku,[Pu]:Uu},l=await f[s](t,c,u);return l.message?{msg:l.message,data:{}}:{msg:"0",data:l}}catch(t){return zi.debug(t),{msg:t.message,data:{}}}}async function Lu(t,e,n){const{code:r,data:o,message:i}=await function(t,e,n=1,r=""){return pu.get("/x/space/arc/search",{params:{jsonp:"jsonp",order:"pubdate",keyword:r,pn:n,tid:0,ps:e,mid:t}})}(t,30,e);if(r)return{message:i};const{aid:a,title:s,author:c}=o.list.vlist[n];return{type:Iu,id:a,title:s,author:c}}async function ku(t,e,n){const{code:r,data:o,msg:i}=await function(t,e,n=1){return pu.get("/audio/music-service/web/song/upper",{params:{jsonp:"jsonp",order:1,pn:n,ps:e,uid:t}})}(t,30,e);if(r)return{message:i};const{data:a}=o,{id:s,uname:c,title:u}=a[n];return{type:Cu,id:s,title:u,author:c}}async function Uu(t,e,n){const{code:r,data:o,message:i}=await function(t,e,n=1){return pu.get("/x/space/article",{params:{callback:"__test",jsonp:"jsonp",sort:"publish_time",pn:n,ps:e,mid:t},requestOptions:{isJsonp:!0}})}(t,12,e);if(r)return{message:i};const{articles:a}=o,{id:s,title:c,author:{name:u}}=a[n];return{type:Pu,id:s,title:c,author:u,mid:t}}const ju=function(){const t=[Ru,xu,()=>xu(!1),Au];return da.BILI_CUSTOMIZE_UP||t.shift(),t}();async function Du(t=0){ju.splice(0,pa.currentStartFun+t);for(let t=0;t<ju.length;t++){const e=ju[t];let n=Number(da.BILI_COIN_RETRY_NUM??4);for(n=n<1?1:n>8?8:n;n--;){await ma();const t=await e();if("-1"===t.msg&&(n=0),"0"===t.msg)return t}n<=0&&(pa.currentStartFun=t)}return{msg:"-1",data:{id:0}}}async function Bu({id:t,coin:e,type:n,mid:r}){const o={[Iu]:Eu,[Cu]:Su,[Pu]:(t,e=1)=>function(t,e,n=1){return pu.post("/x/web-interface/coin/add",{aid:e,upid:t,avtype:2,multiply:n,csrf:da.BILIJCT})}(r,t,e)},i=await o[n](Number(t),e);return{code:i.code,message:i.message||i.msg}}async function Gu(t){if(await async function(){try{const{data:t,code:e}=await wu();if(0==e){const e=da.BILI_TARGET_COINS-t/10;pa.coinsTask=e>0?e:0}}catch(t){}}(),pa.coinsTask<=0||pa.money<=0)return!0;const{data:e,msg:n}=await Du(t.priority);return null!=e&&e.id&&"0"==n?(await ma(),await async function(t,e){const{id:n,title:r,author:o,type:i,mid:a}=t;try{const t=await Bu({id:n,type:i,mid:a});if(0===t.code)pa.money--,pa.coinsTask--,e.num++,zi.info(`给[${r}--up【${o}】]投币成功`);else if(34005===t.code)e.fillCount++,zi.verbose(`当前稿件[${n}]不能再投币了`),e.fillCount>=3&&(zi.warn("自定义用户组投币似乎没有币可投了"),e.priority++);else{if(-111===t.code||-104===t.code)return zi.warn(`${n} ${t.message} 无法继续进行投币`),!0;if(e.eCount++,zi.warn(`给${n}投币失败 ${t.code} ${t.message}`),e.prevCode===t.code)return!0;e.prevCode=t.code}}catch(t){e.eCount++,zi.error(`投币异常 ${t.message}`)}finally{await ma(1500)}return!1}(e,t)):(t.eCount++,!1)}async function qu(){try{const{data:t,code:e,message:n}=await mu.get("/link_group/v1/member/my_groups");return 0===e?(null==t?void 0:t.list)||[]:(zi.warn(`获取自己的应援团异常失败: ${n}`),[])}catch(t){zi.error(`获取自己的应援团异常: ${t}`)}}const Mu=["(⌒▽⌒)","（￣▽￣）","(=・ω・=)","(｀・ω・´)","(〜￣△￣)〜","(･∀･)","(°∀°)ﾉ","(￣3￣)","╮(￣▽￣)╭","_(:3」∠)_","( ´_ゝ｀)","←_←","→_→","(<_<)","(>_>)","(;¬_¬)","(ﾟДﾟ≡ﾟдﾟ)!?","Σ(ﾟдﾟ;)","Σ( ￣□￣||)","(´；ω；`)","（/TДT)/","(^・ω・^ )","(｡･ω･｡)","(●￣(ｴ)￣●)","ε=ε=(ノ≧∇≦)ノ","(´･_･`)","(-_-#)","（￣へ￣）","(￣ε(#￣) Σ","ヽ(`Д´)ﾉ","（#-_-)┯━┯","(╯°口°)╯(┴—┴","←◡←","( ♥д♥)","Σ>―(〃°ω°〃)♡→","⁄(⁄ ⁄•⁄ω⁄•⁄ ⁄)⁄","(╬ﾟдﾟ)▄︻┻┳═一","･*･:≡(　ε:)","(汗)","(苦笑)"].concat("1","2","3","4","5","6","7","8","9","签到","哈哈");async function Hu(){try{const{code:r,message:o,data:i}=await(t=1,e=256,n=da.USERID,du.get(`/xlive/app-ucenter/v1/fansMedal/panel?page=${t}&page_size=${e}&target_id=${n}`));return 0!==r?(zi.verbose(`获取勋章信息失败 ${r} ${o}`),null):i}catch(t){return zi.error(`获取勋章异常 ${t.message}`),null}var t,e,n}async function Ku(t,e){const n=Mu[Ni(Mu.length-1)];try{const{code:r,message:o}=await function(t,e){const n=da.BILIJCT,r=n;return e||(e=Ni(10).toString()),du.post("/msg/send",{color:5566168,fontsize:25,mode:1,msg:e,rnd:Date.now(),roomid:t,bubble:0,csrf:n,csrf_token:r})}(t,n);return 0===r||(11e3===r?(zi.warn(`【${e}】${t}-可能未开启评论`),!1):(zi.warn(`【${e}】${t}-发送失败 ${o}`),zi.verbose(`code: ${r}`),!1))}catch(t){zi.verbose(`发送弹幕异常 ${t.message}`)}}async function Yu(){try{const{data:t,message:e,code:n}=await _u();if(0!==n)return void zi.warn(`获取用户信息失败：${n} ${e}`);!function(t){var e;pa.bCoinCouponBalance=(null===(e=t.wallet)||void 0===e?void 0:e.coupon_balance)||0}(t)}catch(t){zi.error(`获取用户信息异常：${t.message}`)}}var Fu;async function Ju(t){try{const e=function(t){switch(t){case 1:return"B 币券";case 2:return"大会员优惠券";default:return""}}(t),{code:n,message:r}=await function(t){return pu.post("/x/vip/privilege/receive",{csrf:da.BILIJCT,type:t})}(t);let o="成功";return 0===n&&(o=`失败 ${r}`),zi.info(`领取${e} ${o}`),!0}catch(t){zi.error(`领取权益出现异常：${t.message}`)}return!1}async function Qu(t){let e=0,n=!1;for(;!(n||(n=await Ju(t),e>2));)e++;return n}!function(t){t[t["成功"]=4]="成功",t[t["低于20电池"]=-2]="低于20电池",t[t["B币不足"]=-4]="B币不足"}(Fu||(Fu={}));let zu=0;async function Wu(){try{const{data:{list:t}}=await hu();return t.filter((t=>{if(t.expire_at<=0)return!1;const e=(1e3*t.expire_at-(new Date).getTime())/864e5<2,n=![1,30607].includes(t.gift_id);return n&&e&&zi.info(`${t.gift_name} 即将过期请尽快投喂`),!n&&e}))}catch(t){if(zu)return null;await Wu(),zu++}}async function Xu(t){try{const{data:{live_room:e,name:n}}=await function(t){return pu.get(`/x/space/acc/info?mid=${t}&jsonp=jsonp`)}(t);if(await ma(),e.roomStatus)return{roomid:e.roomid,name:n}}catch{}}function Vu(t,e,n,r){const o=da.BILIJCT,i={is_fav:0,main_id:e,oid:t,detail_id:n,count:r,csrf:o,csrf_token:o};return pu.post("/x/esports/guess/add",i)}function Zu(){return pa.money-da.MATCH_COINS<da.BILI_TARGET_COINS&&(zi.info(`需要保留${da.BILI_TARGET_COINS}个硬币，任务结束`),!0)}function tf(t,e,n,r,o){const i=Fi(da.COOKIE),a=i,s=[Ji(da.COOKIE),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))];return{ua:da.USER_AGENT,id:[n,e,o,t],csrf_token:i,csrf:a,device:s,uname:r}}async function ef(){try{await Ec.get("https://api.live.bilibili.com/relation/v1/Feed/heartBeat")}catch{}}async function nf(t){const{data:{area_id:e,parent_area_id:n,room_id:r}}=await function(t){return du.get(`/room/v1/Room/get_info?room_id=${t}&from=room`)}(t);return{room_id:r,area_id:e,parent_area_id:n}}async function rf(t,e){const n={id:JSON.stringify(t.id),device:JSON.stringify(t.device),ts:(new Date).getTime(),is_patch:0,heart_beat:"[]",ua:t.ua,visit_id:"",csrf:t.csrf,csrf_token:t.csrf_token};try{const{data:r,code:o}=await function(t){return Ec.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/E",t)}(n);if(0===o)return zi.info(`进入【${t.uname}】的直播间`),e.v++,r}catch(t){zi.verbose(t)}}async function of(t,e,n){if(n.v>6)return;const r={id:JSON.stringify(e.id),device:JSON.stringify(e.device),ets:t.timestamp,benchmark:t.secret_key,time:60,ts:(new Date).getTime(),ua:e.ua},o=function(t,e){const[n,r,o,i]=JSON.parse(t.id),[a,s]=JSON.parse(t.device),{ets:c,time:u,ts:f}=t,l={platform:"web",parent_id:n,area_id:r,seq_id:o,room_id:i,buvid:a,uuid:s,ets:c,time:u,ts:f},d=t.benchmark,p=["MD5","SHA1","SHA256","SHA224","SHA512","SHA384"];let m=JSON.stringify(l);for(const t of e)m=g.createHmac(p[t],d).update(m).digest("hex");return m}(r,t.secret_rule);try{const{data:t,code:i,message:a}=await function(t){return Ec.post("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/X",t)}(Object.assign({visit_id:"",csrf:e.csrf,csrf_token:e.csrf_token,s:o},r));return 0===i?(zi.info(`向【${e.uname}】发送第${n.v}次心跳`),n.v++):zi.warn(`向【${e.uname}】发送第${n.v}次心跳失败 ${i} ${a}`),t}catch(t){zi.verbose(t)}}async function af(t=1,e=10){try{const{code:n,message:r,data:o}=await yu(t,e);return 0!==n?(zi.verbose(`获取直播间失败 ${n} ${r}`),null):o}catch(t){return zi.verbose(`获取直播间异常 ${t.message}`),null}}async function sf(t=!0){const e=await async function(){let t=0;try{var e,n;const{data:r,code:o}=await hu();return 0!==o||(null===(e=r.list)||void 0===e?void 0:e.length)<=0?24:(null===(n=r.list)||void 0===n||n.forEach((e=>{if(30607===e.gift_id){const n=(1e3*e.expire_at-(new Date).getTime())/864e5;n>6&&n<=7&&(t+=e.gift_num)}})),t>=24?0:24-t)}catch(t){}return 24}();let n;return t?n=await async function(){const{items:t,page_info:e}=await af();let{total_page:n}=e;if(n&&n>1){n=n>3?3:n;for(let e=2;e<=n;e++){const n=await af(e,10);t.push(...n.items)}}return t}():({items:n}=await af()),{fansMedalList:n,heartNum:e}}async function cf(t,e,n,r){if(!r.v||e[n])return await ef(),await ma(500),0===r.v?e[n]=await rf(t,r):e[n]=await of(e[n],t,r),"done"}async function uf(t,e){const n=[];let r=0;for(let o=0;o<6;o++){let i=0;if(i>=e)break;const a=t.length;r=0;for(let s=0;s<a&&!(i>=e);s++){const e=(new Date).getTime(),a=t[s],{roomid:c,uname:u}=a,{room_id:f,area_id:l,parent_area_id:d}=await nf(c),p=tf(f,l,d,u,o);await cf(p,n,s,{v:o}),await ma(2e3),r+=(new Date).getTime()-e,i++}o<5&&await ma(6e4-r)}return"done"}async function ff(t){let e,n;if(t){const{d:r,hn:o}=JSON.parse(t);e="string"==typeof r?JSON.parse(vi(r)):r||[{seq:{v:0}}],n=o||{v:0}}else e=[{seq:{v:0}}],n={v:0};let r=0;if(e[0]&&!e[0].seq.v){e.length=0;const{heartNum:t,fansMedalList:o}=await sf();n.v=t;for(const t of o){if(0===n.v)return zi.info("今日获取小星星已经达到 24"),0;if(r>=n.v)break;const{roomid:o,uname:i}=t,{room_id:a,area_id:s,parent_area_id:c}=await nf(o),u={v:0},f=tf(a,s,c,i,u.v);await ef(),await ma(500);const l=await rf(f,u);e.push({data:l,baseData:f,seq:u}),r++}}else{!function(t){const e=Ji(da.COOKIE),n=Fi(da.COOKIE),r=da.USER_AGENT;t.forEach((t=>{t.baseData.ua=r,t.baseData.csrf=t.baseData.csrf_token=n,t.baseData.device[0]=e,t.baseData.id[2]=t.seq.v}))}(e);for(const t of e)if(await ef(),t.data&&(t.data=await of(t.data,t.baseData,t.seq)),await ma(1e3),r++,t.seq.v>5&&(t.seq.v=0,r>=n.v))return zi.info("今日获取小心心完成"),0;if(e.find((t=>t.seq.v>5)))return 1}return function(t){t.forEach((t=>{delete t.baseData.csrf,delete t.baseData.csrf_token,delete t.baseData.ua,t.baseData.device[0]=0}))}(e),{d:yi(JSON.stringify(e)),hn:n,l:e.length}}async function lf(t){const{data:e,code:n}=await pu.get("/x/relation/tags?jsonp=jsonp&callback=__jp3",{headers:{Referer:"https://space.bilibili.com/1/fans/follow?tagid=0"},requestOptions:{isJsonp:!0}});if(0===n)return e.find((e=>e.name===t));zi.warn(`获取分组列表失败: ${n}`)}async function df(t){const e=await lf(t);if(e)return e.tagid;await ma(300);const{data:n,code:r,message:o}=await(i=t,pu.post("/x/relation/tag/create",{tag:i,jsonp:"jsonp",csrf:da.BILIJCT}));var i;if(22106===r){await ma(300);const e=await lf(t);return e&&e.tagid}return 0!==r&&zi.warn(`创建分组失败: ${r}-${o}`),n.tagid}async function pf(t,e,n,r=1){if(t.length>e.length)return;const{data:o,code:i,message:a}=await Tu(r,20,0);if(0===i){for(const{mid:r,uname:i}of o){if(t.length>=e.length)return;if(r===n)return;(e.includes(r)||e.includes(i))&&t.push({mid:r,uname:i})}if(!(o.length<20))return await pf(t,e,n,r+1)}else zi.warn(`获取关注用户失败: ${i}-${a}`)}const gf=0,mf=1,hf=5,yf=1,vf=504,_f=1096;let wf;async function Tf(){try{const{data:t,code:e,message:n}=await du.get("/xlive/web-interface/v1/index/getWebAreaList?source_id=2");return 0!==e&&zi.info(`获取直播分区失败: ${e}-${n}`),t.data.map((t=>t.list)).map((t=>t.map((t=>({areaId:t.id,parentId:t.parent_id})))))}catch(t){throw zi.error(`获取直播分区异常: ${t.message}`),t}}async function bf(t,e,n=1){try{await ma(100);const{data:r,code:o,message:i}=await function(t,e,n){return du.get(`/xlive/web-interface/v1/second/getList?platform=web&parent_area_id=${t}&area_id=${e}&page=${n}`)}(e,t,n);return 0!==o&&zi.info(`获取直播间列表失败: ${o}-${i}`),function(t){const e=[],n=[];return t.forEach((t=>{const r=t.pendant_info[2];r&&(r.pendent_id===vf?e.push(t):r.pendent_id===_f&&n.push(t))})),{lotteryTime:e,lotteryPacket:n}}(r.list).lotteryTime}catch(t){throw zi.error(`获取直播间列表异常: ${t.message}`),t}}async function $f(t,e,n=1){const r=await bf(t,e,n),o=[];for(const t of r){const e=await Of(t);e&&(o.push({...e,uid:t.uid,uname:t.uname}),await ma(100))}return o}async function Of(t){if(da.LOTTERY_UP_BLACKLIST.includes(t.uid))return void zi.info(`跳过黑名单用户: ${t.uname}`);let e,n,r;try{({data:n,code:e,message:r}=await(o=t.roomid,du.get(`/xlive/lottery-interface/v1/Anchor/Check?roomid=${o}`)))}catch(e){return void zi.info(`直播间${t.roomid}检测异常: ${e.message}`)}var o;if(0!==e)return void zi.debug(`直播间${t.roomid}检测失败: ${e}-${r}`);if(null===n)return;const i=da.LOTTERY_EXCLUDE.some((t=>n.award_name.match(t)));if(!da.LOTTERY_INCLUDE.some((t=>n.award_name.match(t)))&&i)zi.info(`跳过屏蔽奖品: ${n.award_name}`);else if(n.status!==yf);else if(n.gift_price>0);else{if(n.require_type===gf||n.require_type===mf)return n;if(n.require_type===hf&&pa.userLevel>=n.require_value)return n}}async function Ef(t){try{const{id:n,gift_id:r,gift_num:o,award_name:i,uid:a,uname:s,require_type:c,require_text:u}=t;zi.info(`天选主播：【${s}】`),zi.info(`奖品：${i}`);const{code:f,message:l}=await(e={id:n,gift_id:r,gift_num:o},du.post("/xlive/lottery-interface/v1/Anchor/Join",{...e,csrf:da.BILIJCT,csrf_token:da.BILIJCT,visit_id:Ui(),platform:"pc"}));if(0!==f)return void zi.info(`天选失败: ${f}-${l}`);if(zi.info("天选成功 √"),c===mf){ji(wf,a);(function(t){const e=(t=t.replace("关注主播","")).split(/\s*\+\s*/);return e.shift(),e})(u).forEach((t=>ji(wf,t)))}}catch(t){zi.info(`天选异常: ${t.message}`)}var e}async function Sf(t,e,n=2){for(let r=1;r<=n;r++){const n=await $f(t,e,r);for(const t of n)await Ef(t),await ma(300)}}var If={taskReward:async function(){zi.info("----【每日任务完成情况】----");try{const{data:t,message:e,code:n}=await pu.get("/x/member/web/exp/reward");await ma();const{data:r}=await wu();if(0!=n)return void zi.warn(`状态获取失败: ${n} ${e}`);const o=pa.money-da.BILI_STAY_COINS;let i=0;0===pa.coinsTask?zi.info(`今日投币获取经验: ${r}，还需投币0颗，经验够了，不想投了`):o<=0?zi.info(`今日投币获取经验: ${r}，还需投币0颗，硬币不够了，不投币了`):o<pa.coinsTask?(i=pa.coinsTask-o,zi.info(`投币获取经验: ${r}，还需投币数量: ${i}颗;(目标${pa.coinsTask}颗，忽略部分投币)`)):(i=pa.coinsTask-r/10,zi.info(`投币获取经验: ${r}，还需投币数量: ${i}颗;(目标${pa.coinsTask}颗)`)),pa.coinsTask=i,zi.info("每日分享: "+(t.share?"已完成":"[未完成]")),zi.info("每日播放: "+(t.watch?"已完成":"[未完成]")),pa.share=t.share,pa.watch=t.watch}catch(t){zi.error(`状态获取异常 ${t.message}`)}},liveSignTask:async function(){zi.info("----【直播签到】----");try{const{data:t}=await du.get("/xlive/web-ucenter/v1/sign/WebGetSignInfo");if(1===t.status)return zi.info("已签到，跳过签到"),void zi.info(`已经签到${t.hadSignDays}天，${t.specialText}`)}catch(t){}try{const{code:t,data:e,message:n}=await du.get("/xlive/web-ucenter/v1/sign/DoSign");0===t?zi.info(`直播签到成功: ${e.text}，特别信息: ${e.specialText}，本月签到天数: ${e.hadSignDays}天;`):zi.warn(`直播签到失败: ${t} ${n}`)}catch(t){zi.error(`直播签到异常: ${t.message}`)}},shareAndWatch:async function(){if(zi.info("----【分享/播放视频】----"),pa.share&&pa.watch)return void zi.info("已完成，跳过分享/播放");let t=0;try{let e=await Du();if("-1"===e.msg&&(e=await Au()),"0"!==e.msg)return zi.warn(`获取视频失败 ${e.msg}`),!1;{const{id:n,author:r,title:o}=e.data;t=n,zi.info(`获取视频: ${o} --up【${r}】`)}}catch(t){return zi.error(`获取视频出现异常: ${t.message}`),!1}if(!pa.share){await ma();try{const{code:e,message:n}=await function(t){const e={csrf:da.BILIJCT,aid:t};return pu.post("/x/web-interface/share/add",e)}(t);0===e?zi.info("分享视频成功!"):zi.warn(`分享视频失败: ${e} ${n}`)}catch(t){zi.error(`分享视频异常: ${t.message}`)}}if(!pa.watch){await ma();try{const{code:r,message:o}=await(e=t,n=Ni(4,60),pu.post("/x/click-interface/web/heartbeat",{aid:e,played_time:n}));0===r?zi.info("播放视频成功!"):zi.warn(`播放视频失败: ${r} ${o}`)}catch(t){zi.error(`播放视频异常: ${t.message}`)}}var e,n},silver2Coin:async function(){zi.info("----【银瓜子兑换硬币】----");try{const{data:t,code:e,message:n}=await du.get("/xlive/revenue/v1/wallet/getStatus");if(0!=e&&zi.info(`获取瓜子详情失败 ${n}`),0===t.silver_2_coin_left)zi.info("今日已兑换一次");else if(t.silver<700)zi.info("兑换失败，你瓜子不够了");else{const{message:t}=await du.post("/xlive/revenue/v1/wallet/silver2coin",{csrf_token:da.BILIJCT,csrf:da.BILIJCT});zi.info(`兑换硬币： ${t}`),await du.get("/xlive/revenue/v1/wallet/myWallet?need_bp=1&need_metal=1&platform=pc")}}catch(t){zi.error(`操作异常 ${t.message}`)}},addCoins:async function(){if(zi.info("----【视频投币】----"),!pa.coinsTask)return void zi.info("跳过投币，今日已完成");const t={eCount:0,num:0,prevCode:0,fillCount:0,priority:0};let e=!1;for(;pa.coinsTask&&!e&&t.eCount<5;)e=await Gu(t);t.eCount>=5&&zi.info("出现异常/错误5次，自动退出投币"),zi.info(`一共成功投币${t.num}颗`),zi.info(`硬币还剩${pa.money}颗`)},mangaSign:async function(){zi.info("----【漫画签到】----");try{const{code:t}=await gu.post("/twirp/activity.v1.Activity/ClockIn",{platform:e});0==t?zi.info("漫画签到成功"):zi.warn("漫画签到失败")}catch(e){var t;400===(null===(t=e.response)||void 0===t?void 0:t.status)?zi.info("已经签到过了，跳过任务"):zi.error(`漫画签到异常 ${e.message}`)}var e},supGroupSign:async function(){zi.info("----【应援团签到】----");const t=await qu();await ma();let e=0;for(let o=0;o<t.length;){const i=t[o];try{const{data:t,code:o,message:a}=await(n=i.group_id,r=i.owner_uid,mu.get("/link_setting/v1/link_setting/sign_in",{params:{group_id:n,owner_id:r}}));0===o?0===t.status?e++:zi.info(a):zi.warn(`[${i.group_name}]签到失败 ${a}`)}catch(t){zi.error(`签到异常 ${t.message}`)}finally{await ma()}}var n,r;zi.info(`签到结束，成功${e}/${t.length}`)},liveSendMessage:async function(){zi.info("----【发送直播弹幕】----");const t=await async function(){const{list:t,special_list:e}=await Hu();return t.push(...e),t}(),e=t.length;let n=0,r=0;zi.info(`一共需要发送${e}个直播间`),zi.verbose("所需时间可能很长，请耐心等待");for(let o=0;o<e;o++){const{room_info:i,anchor_info:a,medal:s}=t[o];null!=i&&i.room_id?100===s.today_feed||s.guard_level>0?r++:(await Ku(i.room_id,a.nick_name)&&n++,o<e-1&&await ma(Ni(1e4,25e3))):(zi.info(`【${a.nick_name}】没有直播间哦`),r++)}zi.info(`成功发送${n}个弹幕，跳过${r}个`)},charging:async function(){if(zi.info("----【给目标充电】----"),await Yu(),await ma(),function(){const t=xi(),e=t.getDate(),n=Pi(t),r=da.CHARGE_PRESET_TIME;return pa.bCoinCouponBalance<2?(zi.info(`剩余券为${pa.bCoinCouponBalance}，不足2跳过充电`),!1):n===e?(zi.info("今天是最后一天了"),!0):!(r>e&&(zi.info(`预设时间为${r}，不符合条件`),1))}())try{const t=pa.bCoinCouponBalance||0,e=da.CHARGE_ID;let n=0;zi.info(`b 币券余额${t}`);const r=async()=>{const{code:n,message:r,data:o}=await function(t,e,n=da.USERID,r,o){return pu.post("/x/ugcpay/web/v2/trade/elec/pay/quick",{csrf:da.BILIJCT,bp_num:t,is_bp_remains_prior:e,up_mid:n,otype:r,oid:o})}(t,!0,e);0===n?(zi.info(`【充值结果】${Fu[o.status]}`),o.status===Fu["成功"]&&(pa.chargeOrderNo=o.order_no,await ma(),await async function(){try{if(!pa.chargeOrderNo)return!1;const t=h[Ni(0,h.length-1)],{code:e}=await function(t,e){return pu.post("/x/ugcpay/trade/elec/message",{csrf:da.BILIJCT,message:e,order_id:t})}(pa.chargeOrderNo,t);0===e&&zi.info("留言成功！")}catch{}}())):zi.warn(`充电失败：${n} ${r}`)};for(pa.chargeOrderNo="";!(pa.chargeOrderNo||(await r(),await ma(),n++>2)););}catch(t){zi.error(`充电出现异常：${t.message}`)}},getVipPrivilege:async function(){zi.info("----【领取大会员权益】----"),function(){if(2!==pa.vipType)return zi.info("账号非年度大会员，不需要领取权益"),!1;const t=xi(),e=t.getDate(),n=Pi(t);return 1===e||n===e||(zi.info("今天非预订领取时间，跳过领取"),!1)}()&&(await Qu(1),await Qu(2))},giveGift:async function(){zi.info("----【投喂过期食物】----");try{const t=await Wu();if(await ma(),null==t||!t.length)return void zi.info("没有2天内过期的简单礼物");const e=await async function(){const t=Object.assign([],da.BILI_GIFT_UP),e=()=>t.splice(Ni(da.BILI_GIFT_UP.length-1),1)[0];for(;t.length;){const t=e(),n=await Xu(t);if(n)return{mid:t,...n}}return await async function(){const{data:{count:t,items:e}}=await yu();if(await ma(),!t)return;const n=e[Ni(e.length-1)];return{mid:n.target_id,roomid:n.roomid||0,name:n.uname}}()}();if(!e)return void zi.info("没有找到投喂目标");await async function({roomid:t,mid:e,name:n},r){for(const o of r){await ma();try{const{code:r,message:i,data:a}=await vu({roomid:t,ruid:e,bag_id:o.bag_id,gift_id:o.gift_id,gift_num:o.gift_num});if(0!==r){zi.warn(`向[${n}]投喂[${o.gift_name}]，${i}`);continue}a.gift_list.forEach((t=>{zi.info(`成功给 [${n}] 投喂${t.gift_name}`)}))}catch{}}}(e,t)}catch(t){zi.info(`投喂过期食物异常 ${t}`)}},matchGame:async function(){if(zi.info("----【赛事硬币竞猜】----"),da.MATCH_COINS<=0)return void zi.info("硬币数量不能小于 0");if(Zu())return;const t=await async function(){try{const{code:n,message:r,data:{list:o,page:i}}=await pu.get(`/x/esports/guess/collection/question?pn=1&ps=50&gid=&sids=&stime=${t}&etime=${e}`);return 0!==n?void zi.warn(`获取赛事错误 ${n} ${r}`):0===i.total?(zi.info("今日已经无法获取赛事"),null):o}catch(t){}var t,e}();if(await ma(),!t)return;const e=await async function(t){let e=0;try{for(const n of t){const{contest:t,questions:r}=n,o=t.id,[{id:i,title:a,details:s,is_guess:c}]=r,[u,f]=s;if(Zu())return e;if(c)continue;zi.info(`${a} <=> ${u.odds}:${f.odds}`);const l=u.odds>f.odds;let d;d=da.MATCH_SELECTION>0?l?f:u:l?u:f,zi.info(`预测[ ${d.option} ] ${da.MATCH_COINS} 颗硬币`),await ma();const{code:p}=await Vu(o,i,d.detail_id,da.MATCH_COINS);0!==p?zi.info("预测失败"):(e++,pa.money-=da.MATCH_COINS)}}catch(t){console.warn(t.message)}return e}(function(t,e){return t.filter((t=>{const{questions:n}=t,[{details:r,is_guess:o}]=n;if(o)return!1;const[i,a]=r;return Math.abs(i.odds-a.odds)>=e}))}(t,da.MATCH_DIFF));zi.info(`【竞猜结束】一共参与${e}次预测`)},liveHeart:async function(){zi.info("----【直播心跳】----");const{heartNum:t,fansMedalList:e}=await sf(),n=e&&e.length;if(!n)return void zi.info("没有勋章列表");const r=Math.ceil(t/n);for(let n=0;n<r;n++)await uf(e,t);zi.info("完成")},liveLottery:async function(){zi.info("----【天选时刻】----");try{const t=await async function(){const{data:t,code:e}=await Tu(1,1,0);if(0!==e)throw new Error(`获取最后一个关注失败: ${e}`);return t[0]}();zi.info(`最后一个关注的UP: ${t.uname}`);const e=await async function(){wf=[];const t=await Tf();for(const e of t)for(const t of e)await Sf(t.areaId,t.parentId,da.LOTTERY_PAGE_NUM);return wf}();zi.info("扫描完成");const n=[];await pf(n,e,null==t?void 0:t.mid),await async function(t,e){if(0===t.length)return;const n=await df(e);if(n)for(const e of t){const{code:t,message:r}=await bu(e.mid,n);0!==t&&zi.warn(`移动【${e.uname}】失败: ${t}-${r}`),await ma()}}(n),zi.info("移动关注UP到分组成功")}catch(t){zi.warn(`天选时刻异常: ${t.message}`),zi.debug(t)}zi.info("结束天选时刻")}};async function Cf(t,...e){Qi.value="";try{await async function(){zi.info("----【登录】----");const{data:t,message:e,code:n}=await _u();if(0!==n)throw zi.error(`登录错误 ${n} ${e}`),new Error(e);if(!t.isLogin)throw new Error("接口返回为未登录");await ma(),await Ou(t)}()}catch(t){return zi.error(`登录失败: ${t}`),await fu("登录失败",Qi.value),"未完成"}const n=Ac([...Object.values(If)]);for(const t of n)await t(),await ma();return t&&await t(...e),await fu("每日完成",Qi.value),"完成"}function Pf(t,e){return"scf"===t?e.Message:e.payload}async function xf(t,e,n){const r="scf"===t?(await Promise.resolve().then((function(){return Rf}))).default:(await Promise.resolve().then((function(){return Nf}))).default;return(...t)=>r(e,n,...t)}var Af=Object.freeze({__proto__:null,dailyHandle:async function({event:t,context:e,slsType:n}){const r=Pf(n,t),o=await xf(n,t,e);let i;try{i=JSON.parse(r)}catch(t){}return i&&i.lastTime===xi().getDate().toString()?"今日重复执行":await Cf(o)},liveHeartHandle:async function({event:t,context:e,slsType:n}){const r=Pf(n,t),o=await xf(n,t,e);let i;try{i=JSON.parse(r)}catch(t){}if(i&&!i.d&&i.lastTime===xi().getDate().toString())return"今日重复执行";const a=await ff(r);return 0===a?(await o(),"今日完成"):1===a?(await o({hn:{v:0},d:[{seq:{v:0}}]},Ri(5e3,n)),"等待继续下一轮心跳"):(await o(a,Ri(62e3-1e3*a.l,n)),"等待继续下次心跳")}});var Rf=Object.freeze({__proto__:null,default:async function(t,e,n,r,o=2){if(!t.TriggerName)return!1;if(!process.env.TENCENT_SECRET_ID||!process.env.TENCENT_SECRET_KEY)return zi.info("环境变量不存在TENCENT_SECRET_ID和TENCENT_SECRET_KEY"),!1;const i=await async function(){try{return await Promise.resolve().then((function(){return u(require("tencentcloud-sdk-nodejs"))}))}catch{zi.warn("tencentcloud-sdk-nodejs not found，运行 cd src && yarn add tencentcloud-sdk-nodejs")}}();if(!i)return!1;const a=i.scf.v20180416.Client,s=e.function_name,c=t.TriggerName,f=new a({credential:{secretId:process.env.TENCENT_SECRET_ID,secretKey:process.env.TENCENT_SECRET_KEY},region:e.tencentcloud_region,profile:{httpProfile:{endpoint:"scf.tencentcloudapi.com"}}});async function l(){const t=r||Li(da.config.dailyRunTime,"scf"),e={FunctionName:s,TriggerName:c,Type:"timer",TriggerDesc:t.value,Qualifier:"$DEFAULT"},o=await async function(){try{const{Triggers:t}=await f.ListTriggers({FunctionName:s});return-1!==(null==t?void 0:t.findIndex((t=>t.TriggerName===c)))}catch({code:t,message:e}){return zi.error(`获取trigger失败 ${t} => ${e}`),!1}}();if(zi.info(`修改时间为：${t.string}`),o){const t=await async function(t){try{return await f.DeleteTrigger(t)}catch({code:t,message:e}){return zi.warn(`删除trigger失败 ${t} => ${e}`),!1}}(e);if(!t)return}return!!await async function(t){const e=xi();t.CustomArgument=JSON.stringify({...n,lastTime:e.getDate().toString()});try{return await f.CreateTrigger(t)}catch({code:t,message:e}){return zi.error(`创建trigger失败 ${t} => ${e}`),!1}}(e)}let d=!1;for(;!d&&o;)d=await l(),o--;return d}});var Nf=Object.freeze({__proto__:null,default:async function(t,e,n,r,o=2){if(!t.triggerName)return!1;if(!process.env.ALI_SECRET_ID||!process.env.ALI_SECRET_KEY)return zi.info("环境变量不存在ALI_SECRET_ID和ALI_SECRET_KEY"),!1;const i=await async function(){try{return await Promise.resolve().then((function(){return u(require("@alicloud/fc2"))}))}catch{zi.warn("@alicloud/fc2 not found，运行 yarn add @alicloud/fc2")}}();if(!i)return!1;const a=i.default,s=e.function.name,c=t.triggerName,f=e.service.name,l=new a(e.accountId,{accessKeyID:process.env.ALI_SECRET_ID,accessKeySecret:process.env.ALI_SECRET_KEY,region:e.region});async function d(){const t=r||Li(da.config.dailyRunTime,"fc");return zi.info(`修改时间为：${t.string}`),!!await async function(t){const e=xi(),r=`CRON_TZ=Asia/Shanghai ${t}`;try{return await l.updateTrigger(f,s,c,{triggerConfig:{cronExpression:r,payload:JSON.stringify({...n,lastTime:e.getDate().toString()})}})}catch(t){return zi.error(`更新trigger失败 ${t.message}`),!1}}(t.value)}let p=!1;for(;!p&&o;)p=await d(),o--;return p}});
